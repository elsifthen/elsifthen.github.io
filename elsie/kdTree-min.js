/*! For license information please see kdTree-min.js.LICENSE.txt */
!function(t,n){"function"==typeof define&&define.amd?define(["exports"],n):n("object"==typeof exports?exports:t)}(this,(function(t){function n(t,n,o){this.obj=t,this.left=null,this.right=null,this.parent=o,this.dimension=n}function o(t){this.content=[],this.scoreFunction=t}o.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],n=this.content.pop();return this.content.length>0&&(this.content[0]=n,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var n=this.content.length,o=0;o<n;o++)if(this.content[o]==t){var i=this.content.pop();return void(o!=n-1&&(this.content[o]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.bubbleUp(o):this.sinkDown(o)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var n=this.content[t];t>0;){var o=Math.floor((t+1)/2)-1,i=this.content[o];if(!(this.scoreFunction(n)<this.scoreFunction(i)))break;this.content[o]=n,this.content[t]=i,t=o}},sinkDown:function(t){for(var n=this.content.length,o=this.content[t],i=this.scoreFunction(o);;){var e=2*(t+1),r=e-1,l=null;if(r<n){var u=this.content[r],h=this.scoreFunction(u);h<i&&(l=r)}if(e<n){var s=this.content[e];this.scoreFunction(s)<(null==l?i:h)&&(l=e)}if(null==l)break;this.content[t]=this.content[l],this.content[l]=o,t=l}}},t.kdTree=function(t,i,e){var r=this;Array.isArray(t)?this.root=function t(o,i,r){var l,u,h=i%e.length;return 0===o.length?null:1===o.length?new n(o[0],h,r):(o.sort((function(t,n){return t[e[h]]-n[e[h]]})),(u=new n(o[l=Math.floor(o.length/2)],h,r)).left=t(o.slice(0,l),i+1,u),u.right=t(o.slice(l+1),i+1,u),u)}(t,0,null):function(t){r.root=t,function t(n){n.left&&(n.left.parent=n,t(n.left)),n.right&&(n.right.parent=n,t(n.right))}(r.root)}(t),this.toJSON=function(t){t||(t=this.root);var o=new n(t.obj,t.dimension,null);return t.left&&(o.left=r.toJSON(t.left)),t.right&&(o.right=r.toJSON(t.right)),o},this.insert=function(t){var o,i,r=function n(o,i){if(null===o)return i;var r=e[o.dimension];return t[r]<o.obj[r]?n(o.left,o):n(o.right,o)}(this.root,null);null!==r?(o=new n(t,(r.dimension+1)%e.length,r),i=e[r.dimension],t[i]<r.obj[i]?r.left=o:r.right=o):this.root=new n(t,0,null)},this.remove=function(t){var n;null!==(n=function n(o){if(null===o)return null;if(o.obj===t)return o;var i=e[o.dimension];return t[i]<o.obj[i]?n(o.left):n(o.right)}(r.root))&&function t(n){function o(t,n){var i,r,l,u,h;return null===t?null:(i=e[n],t.dimension===n?null!==t.left?o(t.left,n):t:(r=t.obj[i],l=o(t.left,n),u=o(t.right,n),h=t,null!==l&&l.obj[i]<r&&(h=l),null!==u&&u.obj[i]<h.obj[i]&&(h=u),h))}var i,l,u;if(null===n.left&&null===n.right)return null===n.parent?void(r.root=null):(u=e[n.parent.dimension],void(n.obj[u]<n.parent.obj[u]?n.parent.left=null:n.parent.right=null));null!==n.right?(l=(i=o(n.right,n.dimension)).obj,t(i),n.obj=l):(l=(i=o(n.left,n.dimension)).obj,t(i),n.right=n.left,n.left=null,n.obj=l)}(n)},this.nearest=function(t,n,l){var u,h,s;if(s=new o((function(t){return-t[1]})),l)for(u=0;u<n;u+=1)s.push([null,l]);for(r.root&&function o(r){function l(t,o){s.push([t,o]),s.size()>n&&s.pop()}var u,h,f,c,a=e[r.dimension],g=i(t,r.obj),p={};for(c=0;c<e.length;c+=1)c===r.dimension?p[e[c]]=t[e[c]]:p[e[c]]=r.obj[e[c]];h=i(p,r.obj),null!==r.right||null!==r.left?(o(u=null===r.right?r.left:null===r.left?r.right:t[a]<r.obj[a]?r.left:r.right),(s.size()<n||g<s.peek()[1])&&l(r,g),(s.size()<n||Math.abs(h)<s.peek()[1])&&null!==(f=u===r.left?r.right:r.left)&&o(f)):(s.size()<n||g<s.peek()[1])&&l(r,g)}(r.root),h=[],u=0;u<Math.min(n,s.content.length);u+=1)s.content[u][0]&&h.push([s.content[u][0].obj,s.content[u][1]]);return h},this.balanceFactor=function(){return function t(n){return null===n?0:Math.max(t(n.left),t(n.right))+1}(r.root)/(Math.log(function t(n){return null===n?0:t(n.left)+t(n.right)+1}(r.root))/Math.log(2))}},t.BinaryHeap=o}));